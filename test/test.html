<!doctype html>
<html>
  <head>
    <title>NestJS Socket.IO Test Client</title>
  </head>
  <body>
    <h1>NestJS Socket.IO Test Client</h1>
    <p>M·ªü console c·ªßa tr√¨nh duy·ªát (F12) ƒë·ªÉ xem log.</p>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <script>
      // GI·∫¢ L·∫¨P: L·∫•y JWT token. Trong ·ª©ng d·ª•ng th·∫≠t, b·∫°n s·∫Ω l·∫•y token
      // sau khi g·ªçi API ƒëƒÉng nh·∫≠p.
      // const jwtToken = prompt('Please enter your JWT token:');
      const jwtToken =
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';

      if (jwtToken) {
        console.log('Attempting to connect with token...');

        const socket = io('http://localhost:3000', {
          // ƒê·ªãa ch·ªâ SocketService
          extraHeaders: {
            Authorization: `Bearer ${jwtToken}`,
          },
        });

        // L·∫Øng nghe s·ª± ki·ªán 'connect'
        socket.on('connect', () => {
          console.log(
            `‚úÖ Connection successful! Your Socket ID is: ${socket.id}`,
          );
          document.body.style.backgroundColor = '#d4edda'; // Xanh l√°
        });

        // L·∫Øng nghe s·ª± ki·ªán 'disconnect'
        socket.on('disconnect', (reason) => {
          console.log(`üîå Disconnected. Reason: ${reason}`);
          if (reason === 'io server disconnect') {
            // Server ch·ªß ƒë·ªông ng·∫Øt k·∫øt n·ªëi (v√≠ d·ª•: x√°c th·ª±c th·∫•t b·∫°i)
            console.error('Authentication likely failed.');
          }
          document.body.style.backgroundColor = '#f8d7da'; // ƒê·ªè
        });

        // L·∫Øng nghe c√°c l·ªói chung do server g·ª≠i v·ªÅ
        socket.on('error', (error) => {
          console.error('‚ùå Server sent an error:', error);
          document.body.style.backgroundColor = '#fff3cd'; // V√†ng
        });
      } else {
        alert('No JWT token provided. Connection aborted.');
      }
    </script>
  </body>
</html>
